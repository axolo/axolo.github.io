(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{444:function(s,e,n){"use strict";n.r(e);var t=n(0),a=Object(t.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"nginx反向代理实现https"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx反向代理实现https"}},[s._v("#")]),s._v(" NGiNX反向代理实现https")]),s._v(" "),n("p",[s._v("越来越多的应用需要https支持，因此支持https是大势所趋，也是必须的。\n比如微信小程序的第三方数据接口必须是https协议的，Google将所有http协议默认为不安全协议。\n所以开发上也需要对https进行测试，而https的前提就是需要SSL证书，哪怕是自建的。")]),s._v(" "),n("p",[s._v("参见："),n("a",{attrs:{href:"https://blog.csdn.net/pz0605/article/details/51954876",target:"_blank",rel:"noopener noreferrer"}},[s._v("自建证书配置HTTPS服务器"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成私钥")]),s._v("\nopenssl genrsa -out private.key "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成证书请求")]),s._v("\nopenssl req -new -key private.key -out server.csr\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成服务器的私钥，去除密钥口令")]),s._v("\nopenssl rsa -in private.key -out server.key\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用私钥为证书请求签名，生成给服务器签署的证书，格式是x509的PEM格式")]),s._v("\nopenssl x509 -req -in server.csr -out server.crt -signkey server.key -days "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3650")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("经过以上步骤得到server.crt和server.key，拷贝到nginx的certs目录。\n由于证书是自建的，一般情况下浏览器会给出不安全提示，仅供开发环境测试使用。")]),s._v(" "),n("div",{staticClass:"language-ini line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ini"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx/conf/nginx.conf")]),s._v("\nserver {\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("  # 开启SSL")]),s._v("\n  listen       443 ssl;\n  server_name  localhost;                   # 外网域名\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("  # 加载证书，可用openssl自建证书")]),s._v("\n  ssl_certificate      ../certs/server.crt;\n  ssl_certificate_key  ../certs/server.key;\n  ssl_session_cache    shared:SSL:1m;\n  ssl_session_timeout  5m;\n  ssl_ciphers  HIGH:!aNULL:!MD5;\n  ssl_prefer_server_ciphers  on;\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("  # 反向代理")]),s._v("\n  location / {\n    proxy_pass        http://localhost:7001;  # 内网应用网址\n  }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("虽然"),n("a",{attrs:{href:"https://github.com/eggjs/egg-cluster",target:"_blank",rel:"noopener noreferrer"}},[s._v("egg-cluster"),n("OutboundLink")],1),s._v("内置参数支持https，\n但这终究不是API该做的事情，就跟OAuth不应该由API来做一样。\n能者多劳就是个谬论，往往是无能者的无奈之举和推脱之辞。\nhttps、cluster、负载均衡、反向代理这样的事，注定WEB服务器来做，是诸如NGiNX、Apache、IIS之类的天职。")])])}),[],!1,null,null,null);e.default=a.exports}}]);