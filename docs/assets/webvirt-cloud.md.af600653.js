import{_ as s,o as a,c as n,e as l}from"./app.461629eb.js";const p="/assets/webvirt-cloud-compute.66e36177.png",e="/assets/webvirt-cloud-storage.b8fe4ce6.png",o="/assets/webvirt-cloud-network.7b06a047.png",t="/assets/webvirt-cloud-instance.c488367e.png",c="/assets/webvirt-cloud-console.54f33077.png",g=JSON.parse('{"title":"WebVirtCloud 部署笔记","description":"图文并茂的 WebVirtCloud 部署笔记","frontmatter":{"title":"WebVirtCloud 部署笔记","description":"图文并茂的 WebVirtCloud 部署笔记","time":"2013-12-30T00:00:00.000Z","category":"运维","tags":["CentOS","Linux","虚拟化"]},"headers":[{"level":2,"title":"系统配置","slug":"系统配置","link":"#系统配置","children":[{"level":3,"title":"SELinux","slug":"selinux","link":"#selinux","children":[]},{"level":3,"title":"防火墙","slug":"防火墙","link":"#防火墙","children":[]}]},{"level":2,"title":"安装KVM","slug":"安装kvm","link":"#安装kvm","children":[{"level":3,"title":"虚拟化支持","slug":"虚拟化支持","link":"#虚拟化支持","children":[]},{"level":3,"title":"设置网桥","slug":"设置网桥","link":"#设置网桥","children":[]},{"level":3,"title":"安装KVM依赖","slug":"安装kvm依赖","link":"#安装kvm依赖","children":[]},{"level":3,"title":"设置服务","slug":"设置服务","link":"#设置服务","children":[]}]},{"level":2,"title":"安装WebVirtCloud","slug":"安装webvirtcloud","link":"#安装webvirtcloud","children":[{"level":3,"title":"更新 hypervisor gstfsd","slug":"更新-hypervisor-gstfsd","link":"#更新-hypervisor-gstfsd","children":[]},{"level":3,"title":"获取SECRET_KEY","slug":"获取secret-key","link":"#获取secret-key","children":[]},{"level":3,"title":"安装WebVirtCloud控制台","slug":"安装webvirtcloud控制台","link":"#安装webvirtcloud控制台","children":[]},{"level":3,"title":"用户和组设置","slug":"用户和组设置","link":"#用户和组设置","children":[]},{"level":3,"title":"启动服务","slug":"启动服务","link":"#启动服务","children":[]},{"level":3,"title":"添加SSH KEY","slug":"添加ssh-key","link":"#添加ssh-key","children":[]}]},{"level":2,"title":"控制台","slug":"控制台","link":"#控制台","children":[{"level":3,"title":"进入控制台","slug":"进入控制台","link":"#进入控制台","children":[]},{"level":3,"title":"基础架构","slug":"基础架构","link":"#基础架构","children":[]},{"level":3,"title":"存储池","slug":"存储池","link":"#存储池","children":[]},{"level":3,"title":"网络","slug":"网络","link":"#网络","children":[]},{"level":3,"title":"实例","slug":"实例","link":"#实例","children":[]},{"level":3,"title":"会话","slug":"会话","link":"#会话","children":[]}]}],"relativePath":"webvirt-cloud.md","lastUpdated":1673773212000}'),r={name:"webvirt-cloud.md"},i=l(`<h1 id="webvirtcloud-部署笔记" tabindex="-1">WebVirtCloud 部署笔记 <a class="header-anchor" href="#webvirtcloud-部署笔记" aria-hidden="true">#</a></h1><h2 id="系统配置" tabindex="-1">系统配置 <a class="header-anchor" href="#系统配置" aria-hidden="true">#</a></h2><h3 id="selinux" tabindex="-1">SELinux <a class="header-anchor" href="#selinux" aria-hidden="true">#</a></h3><p>允许<code>WebVirtCloud</code>通行</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">semanage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">fcontext</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">httpd_sys_content_t</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/srv/webvirtcloud(/.*)</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>或关闭<code>SELINUX</code></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/selinux/config</span></span>
<span class="line"></span></code></pre></div><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">SELINUX</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">disabled</span></span>
<span class="line"></span></code></pre></div><h3 id="防火墙" tabindex="-1">防火墙 <a class="header-anchor" href="#防火墙" aria-hidden="true">#</a></h3><p>允许<code>nginx</code>和<code>novnc</code>通行。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=80/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;"># nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=6080/tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># novnc</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--reload</span></span>
<span class="line"></span></code></pre></div><h2 id="安装kvm" tabindex="-1">安装KVM <a class="header-anchor" href="#安装kvm" aria-hidden="true">#</a></h2><h3 id="虚拟化支持" tabindex="-1">虚拟化支持 <a class="header-anchor" href="#虚拟化支持" aria-hidden="true">#</a></h3><p>执行以下命令，若有高亮<code>vmx</code>或<code>svm</code>输出表示硬件支持虚拟化。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">egrep</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">(vmx|svm)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--color=always</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/proc/cpuinfo</span></span>
<span class="line"></span></code></pre></div><h3 id="设置网桥" tabindex="-1">设置网桥 <a class="header-anchor" href="#设置网桥" aria-hidden="true">#</a></h3><p>网桥相当于外网和虚拟机之间的交换机。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">             +-----------+     +----------+     +----------+</span></span>
<span class="line"><span style="color:#A6ACCD;">Internet --- | HOST eth0 | --- | HOST br0 | --- | VMs eth0 | --- VMs</span></span>
<span class="line"><span style="color:#A6ACCD;">             +-----------+     +----------+     +----------+</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/sysconfig/network-scripts/ifcfg-enp2s0</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/sysconfig/network-scripts/ifcfg-br0</span></span>
<span class="line"></span></code></pre></div><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">TYPE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Bridge                                   </span><span style="color:#676E95;font-style:italic;"># 类型为网桥</span></span>
<span class="line"><span style="color:#F07178;">PROXY_METHOD</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">none</span></span>
<span class="line"><span style="color:#F07178;">BROWSER_ONLY</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">no</span></span>
<span class="line"><span style="color:#F07178;">BOOTPROTO</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">dhcp                                </span><span style="color:#676E95;font-style:italic;"># MAC未绑定IP时建议配置静态IP</span></span>
<span class="line"><span style="color:#F07178;">DEFROUTE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">yes</span></span>
<span class="line"><span style="color:#F07178;">IPV4_FAILURE_FATAL</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">no</span></span>
<span class="line"><span style="color:#F07178;">IPV6INIT</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">yes</span></span>
<span class="line"><span style="color:#F07178;">IPV6_AUTOCONF</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">yes</span></span>
<span class="line"><span style="color:#F07178;">IPV6_DEFROUTE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">yes</span></span>
<span class="line"><span style="color:#F07178;">IPV6_FAILURE_FATAL</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">no</span></span>
<span class="line"><span style="color:#F07178;">IPV6_ADDR_GEN_MODE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">stable-privacy</span></span>
<span class="line"><span style="color:#F07178;">NAME</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">br0                                      </span><span style="color:#676E95;font-style:italic;"># 名称</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># UUID=87cd35a1-1421-4066-a7bc-9d8ba4e727d5   # 注释掉</span></span>
<span class="line"><span style="color:#F07178;">DEVICE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">br0                                    </span><span style="color:#676E95;font-style:italic;"># 设备</span></span>
<span class="line"><span style="color:#F07178;">ONBOOT</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">yes</span></span>
<span class="line"><span style="color:#F07178;">ZONE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">public</span></span>
<span class="line"></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/sysconfig/network-scripts/ifcfg-enp2s0</span></span>
<span class="line"></span></code></pre></div><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">BRIDGE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">br0</span></span>
<span class="line"><span style="color:#F07178;">TYPE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Ethernet</span></span>
<span class="line"><span style="color:#F07178;">PROXY_METHOD</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">none</span></span>
<span class="line"><span style="color:#F07178;">BROWSER_ONLY</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">no</span></span>
<span class="line"><span style="color:#F07178;">BOOTPROTO</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">dhcp</span></span>
<span class="line"><span style="color:#F07178;">DEFROUTE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">yes</span></span>
<span class="line"><span style="color:#F07178;">IPV4_FAILURE_FATAL</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">no</span></span>
<span class="line"><span style="color:#F07178;">IPV6INIT</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">yes</span></span>
<span class="line"><span style="color:#F07178;">IPV6_AUTOCONF</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">yes</span></span>
<span class="line"><span style="color:#F07178;">IPV6_DEFROUTE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">yes</span></span>
<span class="line"><span style="color:#F07178;">IPV6_FAILURE_FATAL</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">no</span></span>
<span class="line"><span style="color:#F07178;">IPV6_ADDR_GEN_MODE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">stable-privacy</span></span>
<span class="line"><span style="color:#F07178;">NAME</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">enp2s0</span></span>
<span class="line"><span style="color:#F07178;">UUID</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">87cd35a1-1421-4066-a7bc-9d8ba4e727d5</span></span>
<span class="line"><span style="color:#F07178;">DEVICE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">enp2s0</span></span>
<span class="line"><span style="color:#F07178;">ONBOOT</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">yes</span></span>
<span class="line"><span style="color:#F07178;">ZONE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">public</span></span>
<span class="line"></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">network</span></span>
<span class="line"><span style="color:#FFCB6B;">brctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">show</span></span>
<span class="line"></span></code></pre></div><h3 id="安装kvm依赖" tabindex="-1">安装KVM依赖 <a class="header-anchor" href="#安装kvm依赖" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">kvm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">qemu-kvm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">qemu-kvm-tools</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">libvirt</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">libvirt-python</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">libvirt-client</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">virt-install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">python-virtinst</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bridge-utils</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">libguestfs-tools</span></span>
<span class="line"></span></code></pre></div><table><thead><tr><th>名称</th><th>必须</th><th>说明</th></tr></thead><tbody><tr><td>kvm</td><td>是</td><td>KVM核心，KVM虚拟机模块</td></tr><tr><td>qemu-kvm</td><td>是</td><td>QEMU模拟器，QEMU KVM虚拟化模拟器</td></tr><tr><td>qemu-kvm-tools</td><td>是</td><td>QEMU工具，QEMU工具</td></tr><tr><td>libvirt</td><td>是</td><td>虚拟化API，虚拟化平台的开源的API</td></tr><tr><td>libvirt-python</td><td>是</td><td>libvirt Python语言支持</td></tr><tr><td>libvirt-client</td><td></td><td>libvirt 客户端</td></tr><tr><td>virt-install</td><td></td><td>虚拟机安装工具</td></tr><tr><td>python-virtinst</td><td></td><td>虚拟机安装工具Python语言支持</td></tr><tr><td>brige-utils</td><td></td><td>网桥管理工具</td></tr><tr><td>libguestfs-tools</td><td></td><td>虚拟机镜像管理工具</td></tr><tr><td>virt-manager</td><td></td><td>虚拟机管理工具，需要GUI</td></tr><tr><td>virt-viewer</td><td></td><td>虚拟机查看工具，需要GUI</td></tr><tr><td>virt-v2v</td><td></td><td>虚拟机镜像转换工具</td></tr></tbody></table><h3 id="设置服务" tabindex="-1">设置服务 <a class="header-anchor" href="#设置服务" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">enable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">libvirtd</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># 设置服务自启动</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">libvirtd</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 启动服务</span></span>
<span class="line"></span></code></pre></div><h2 id="安装webvirtcloud" tabindex="-1">安装WebVirtCloud <a class="header-anchor" href="#安装webvirtcloud" aria-hidden="true">#</a></h2><p>参见：<a href="https://github.com/retspen/webvirtcloud" target="_blank" rel="noreferrer">https://github.com/retspen/webvirtcloud</a></p><h3 id="更新-hypervisor-gstfsd" tabindex="-1">更新 hypervisor gstfsd <a class="header-anchor" href="#更新-hypervisor-gstfsd" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">wget</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-O</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://clck.ru/9VMRH</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tee</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/local/bin/gstfsd</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">supervisor</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span></span>
<span class="line"></span></code></pre></div><h3 id="获取secret-key" tabindex="-1">获取SECRET_KEY <a class="header-anchor" href="#获取secret-key" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/srv/webvirtcloud/webvirtcloud/settings.py</span></span>
<span class="line"></span></code></pre></div><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> random</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> string</span></span>
<span class="line"><span style="color:#A6ACCD;">haystack </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> string</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">ascii_letters</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> string</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">digits</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> string</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">punctuation</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">([</span><span style="color:#82AAFF;">random</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">SystemRandom</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">choice</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">haystack</span><span style="color:#89DDFF;">)</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#82AAFF;"> _ </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#82AAFF;"> range</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">)]))</span></span>
<span class="line"></span></code></pre></div><h3 id="安装webvirtcloud控制台" tabindex="-1">安装WebVirtCloud控制台 <a class="header-anchor" href="#安装webvirtcloud控制台" aria-hidden="true">#</a></h3><h4 id="安装webvirtcloud依赖" tabindex="-1">安装WebVirtCloud依赖 <a class="header-anchor" href="#安装webvirtcloud依赖" aria-hidden="true">#</a></h4><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">python-virtualenv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">python-devel</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">libvirt-devel</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">glibc</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">gcc</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">supervisor</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">python-lxml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">python-libguestfs</span></span>
<span class="line"></span></code></pre></div><h4 id="克隆仓库" tabindex="-1">克隆仓库 <a class="header-anchor" href="#克隆仓库" aria-hidden="true">#</a></h4><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/srv</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/srv</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/retspen/webvirtcloud</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">webvirtcloud</span></span>
<span class="line"><span style="color:#FFCB6B;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">webvirtcloud/settings.py.template</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">webvirtcloud/settings.py</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># now put secret key to webvirtcloud/settings.py</span></span>
<span class="line"></span></code></pre></div><h4 id="开始安装webvirtcloud" tabindex="-1">开始安装WebVirtCloud <a class="header-anchor" href="#开始安装webvirtcloud" aria-hidden="true">#</a></h4><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">virtualenv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">venv</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">source</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">venv/bin/activate</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">venv/bin/pip</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-r</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">conf/requirements.txt</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">conf/nginx/webvirtcloud.conf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/nginx/conf.d/</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">venv/bin/python</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">manage.py</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrate</span></span>
<span class="line"></span></code></pre></div><h4 id="配置supervisor" tabindex="-1">配置supervisor <a class="header-anchor" href="#配置supervisor" aria-hidden="true">#</a></h4><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/supervisord.conf</span></span>
<span class="line"></span></code></pre></div><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 把以下内容添加到 [include] 段的 \`files = ...\` 之后</span></span>
<span class="line"><span style="color:#89DDFF;">[program:webvirtcloud]</span></span>
<span class="line"><span style="color:#F07178;">command</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">/srv/webvirtcloud/venv/bin/gunicorn webvirtcloud.wsgi:application -c /srv/webvirtcloud/gunicorn.conf.py</span></span>
<span class="line"><span style="color:#F07178;">directory</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">/srv/webvirtcloud</span></span>
<span class="line"><span style="color:#F07178;">user</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">nginx</span></span>
<span class="line"><span style="color:#F07178;">autostart</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">true</span></span>
<span class="line"><span style="color:#F07178;">autorestart</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">true</span></span>
<span class="line"><span style="color:#F07178;">redirect_stderr</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">true</span></span>
<span class="line"><span style="color:#89DDFF;">[program:novncd]</span></span>
<span class="line"><span style="color:#F07178;">command</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">/srv/webvirtcloud/venv/bin/python /srv/webvirtcloud/console/novncd</span></span>
<span class="line"><span style="color:#F07178;">directory</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">/srv/webvirtcloud</span></span>
<span class="line"><span style="color:#F07178;">user</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">nginx</span></span>
<span class="line"><span style="color:#F07178;">autostart</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">true</span></span>
<span class="line"><span style="color:#F07178;">autorestart</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">true</span></span>
<span class="line"><span style="color:#F07178;">redirect_stderr</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">true</span></span>
<span class="line"></span></code></pre></div><h4 id="配置nginx" tabindex="-1">配置nginx <a class="header-anchor" href="#配置nginx" aria-hidden="true">#</a></h4><p>注释<code>nginx</code>原有<code>server</code>段相关配置</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/nginx/nginx.conf</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#    server {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        listen       80 default_server;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        listen       [::]:80 default_server;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        server_name  _;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        root         /usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        # Load configuration files for the default server block.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        include /etc/nginx/default.d/*.conf;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        location / {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        error_page 404 /404.html;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#            location = /40x.html {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        error_page 500 502 503 504 /50x.html;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#            location = /50x.html {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>确保webvirtcloud.conf配置正确</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/nginx/conf.d/webvirtcloud.conf</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">gunicorn_server </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#server unix:/srv/webvirtcloud/venv/wvcloud.socket fail_timeout=0;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:8000 </span><span style="color:#A6ACCD;font-style:italic;">fail_timeout</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">server {</span></span>
<span class="line"><span style="color:#A6ACCD;">    listen </span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">servername.domain.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;">/var/log/nginx/webvirtcloud-access_log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/static/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/srv/webvirtcloud</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> expires </span><span style="color:#A6ACCD;">max</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://gunicorn_server</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Real-IP </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Forwarded-for </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">host:</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">server_port</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Forwarded-Proto </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_connect_timeout </span><span style="color:#A6ACCD;">600</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_read_timeout </span><span style="color:#A6ACCD;">600</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> proxy_send_timeout </span><span style="color:#A6ACCD;">600</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> client_max_body_size </span><span style="color:#A6ACCD;">1024M</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="用户和组设置" tabindex="-1">用户和组设置 <a class="header-anchor" href="#用户和组设置" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">useradd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">webvirtmgr</span></span>
<span class="line"><span style="color:#FFCB6B;">usermod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-G</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">kvm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">webvirtmgr</span></span>
<span class="line"></span></code></pre></div><h3 id="启动服务" tabindex="-1">启动服务 <a class="header-anchor" href="#启动服务" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">supervisord</span></span>
<span class="line"></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">supervisorctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">status</span></span>
<span class="line"></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">gstfsd             RUNNING   pid 24662, uptime 6:01:40</span></span>
<span class="line"><span style="color:#A6ACCD;">novncd             RUNNING   pid 24661, uptime 6:01:40</span></span>
<span class="line"><span style="color:#A6ACCD;">webvirtcloud       RUNNING   pid 24660, uptime 6:01:40</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h3 id="添加ssh-key" tabindex="-1">添加SSH KEY <a class="header-anchor" href="#添加ssh-key" aria-hidden="true">#</a></h3><p>用于控制台添加基础架构</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">su</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">ssh-keygen</span></span>
<span class="line"><span style="color:#FFCB6B;">ssh-copy-id</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root@serverip</span></span>
<span class="line"><span style="color:#FFCB6B;">you</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">need</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">accept</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">key</span></span>
<span class="line"><span style="color:#82AAFF;">exit</span></span>
<span class="line"></span></code></pre></div><h2 id="控制台" tabindex="-1">控制台 <a class="header-anchor" href="#控制台" aria-hidden="true">#</a></h2><h3 id="进入控制台" tabindex="-1">进入控制台 <a class="header-anchor" href="#进入控制台" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">open</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http://serverip</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># username: admin</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># password: admin</span></span>
<span class="line"></span></code></pre></div><h3 id="基础架构" tabindex="-1">基础架构 <a class="header-anchor" href="#基础架构" aria-hidden="true">#</a></h3><p><img src="`+p+`" alt="compute"></p><h3 id="存储池" tabindex="-1">存储池 <a class="header-anchor" href="#存储池" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">755</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-R</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/home/webvirtmgr</span></span>
<span class="line"></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">/home/webvirtmgr</span></span>
<span class="line"><span style="color:#A6ACCD;">|-- images          # 磁盘镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">\`-- iso             # 光盘镜像</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><img src="`+e+'" alt="storage"></p><h3 id="网络" tabindex="-1">网络 <a class="header-anchor" href="#网络" aria-hidden="true">#</a></h3><p><img src="'+o+'" alt="network"></p><h3 id="实例" tabindex="-1">实例 <a class="header-anchor" href="#实例" aria-hidden="true">#</a></h3><p><img src="'+t+'" alt="instance"></p><h3 id="会话" tabindex="-1">会话 <a class="header-anchor" href="#会话" aria-hidden="true">#</a></h3><p><img src="'+c+'" alt="console"></p>',76),y=[i];function C(d,D,A,h,F,u){return a(),n("div",null,y)}const b=s(r,[["render",C]]);export{g as __pageData,b as default};
