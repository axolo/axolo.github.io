import{_ as s,o as a,c as l,g as n}from"./app.373b10f5.js";const h=JSON.parse('{"title":"MySQL 定时备份","description":"定时自动备份 MySQL 是刚需。","frontmatter":{"title":"MySQL 定时备份","description":"定时自动备份 MySQL 是刚需。","time":"2019-05-12T00:00:00.000Z","category":"数据库","tags":["MySQL","DevOps","Shell"]},"headers":[{"level":2,"title":"相关软件","slug":"相关软件","link":"#相关软件","children":[]},{"level":2,"title":"Windows","slug":"windows","link":"#windows","children":[{"level":3,"title":"编写mysql-backup.bat","slug":"编写mysql-backup-bat","link":"#编写mysql-backup-bat","children":[]},{"level":3,"title":"将mysql-backup.bat加入计划任务","slug":"将mysql-backup-bat加入计划任务","link":"#将mysql-backup-bat加入计划任务","children":[]}]},{"level":2,"title":"Linux","slug":"linux","link":"#linux","children":[{"level":3,"title":"修改MySQL配置","slug":"修改mysql配置","link":"#修改mysql配置","children":[]},{"level":3,"title":"编写备份脚本","slug":"编写备份脚本","link":"#编写备份脚本","children":[]},{"level":3,"title":"修改文件属性为可执行","slug":"修改文件属性为可执行","link":"#修改文件属性为可执行","children":[]},{"level":3,"title":"添加到crontab","slug":"添加到crontab","link":"#添加到crontab","children":[]}]}],"relativePath":"mysql-backup.md"}'),e={name:"mysql-backup.md"},p=n(`<h1 id="mysql定时备份" tabindex="-1">MySQL定时备份 <a class="header-anchor" href="#mysql定时备份" aria-hidden="true">#</a></h1><blockquote><p>方跃明 2019-05-12</p></blockquote><h2 id="相关软件" tabindex="-1">相关软件 <a class="header-anchor" href="#相关软件" aria-hidden="true">#</a></h2><ul><li><a href="https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html" target="_blank" rel="noreferrer">mysqldump</a></li><li><a href="http://www.gzip.org" target="_blank" rel="noreferrer">gzip</a></li></ul><p>Windows下需要用到gzip压缩软件，当然也可用zip、7z、rar等软件代替。 gzip安装完成后，方便起见，请将gzip加入Windows的PATH环境变量。</p><h2 id="windows" tabindex="-1">Windows <a class="header-anchor" href="#windows" aria-hidden="true">#</a></h2><h3 id="编写mysql-backup-bat" tabindex="-1">编写mysql-backup.bat <a class="header-anchor" href="#编写mysql-backup-bat" aria-hidden="true">#</a></h3><div class="language-powershell"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">rem 删除一周前的备份</span></span>
<span class="line"><span style="color:#A6ACCD;">forfiles </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">p </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">D:\\Backup\\databasename</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">d </span><span style="color:#F78C6C;">-7</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">c </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cmd /c del /f @path</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">rem 按日期命名备份并压缩</span></span>
<span class="line"><span style="color:#A6ACCD;">mysqldump </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">hhostname </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">uusername </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ppassword </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">databases databasename </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> gzip </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> D:\\Backup\\databasename\\databasename</span><span style="color:#89DDFF;">-%</span><span style="color:#A6ACCD;">date:~</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;">.sql.gz</span></span>
<span class="line"></span></code></pre></div><h3 id="将mysql-backup-bat加入计划任务" tabindex="-1">将mysql-backup.bat加入计划任务 <a class="header-anchor" href="#将mysql-backup-bat加入计划任务" aria-hidden="true">#</a></h3><h2 id="linux" tabindex="-1">Linux <a class="header-anchor" href="#linux" aria-hidden="true">#</a></h2><h3 id="修改mysql配置" tabindex="-1">修改MySQL配置 <a class="header-anchor" href="#修改mysql配置" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/my.cnf</span></span>
<span class="line"></span></code></pre></div><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 加入 mysqldump 相关配置</span></span>
<span class="line"><span style="color:#89DDFF;">[mysqldump]</span></span>
<span class="line"><span style="color:#F07178;">user</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">user</span></span>
<span class="line"><span style="color:#F07178;">password</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">password</span></span>
<span class="line"></span></code></pre></div><h3 id="编写备份脚本" tabindex="-1">编写备份脚本 <a class="header-anchor" href="#编写备份脚本" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">#!/bin/bash</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 定义目录</span></span>
<span class="line"><span style="color:#A6ACCD;">dir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/path/to/backup/mysql/yourdatabase</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 删除一周前的备份</span></span>
<span class="line"><span style="color:#FFCB6B;">find</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">dir</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-ctime</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-type</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">f</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">xargs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-rf</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 每日备份</span></span>
<span class="line"><span style="color:#A6ACCD;">rq</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">date</span><span style="color:#C3E88D;"> +%Y%m%d</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#FFCB6B;">mysqldump</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--databases</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yourdatabase</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">gzip</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">dir</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/yourdatabase-</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">rq</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.sql.gz</span></span>
<span class="line"></span></code></pre></div><h3 id="修改文件属性为可执行" tabindex="-1">修改文件属性为可执行 <a class="header-anchor" href="#修改文件属性为可执行" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/path/to/backmysql.sh</span></span>
<span class="line"></span></code></pre></div><h3 id="添加到crontab" tabindex="-1">添加到<code>crontab</code> <a class="header-anchor" href="#添加到crontab" aria-hidden="true">#</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;"># mysql-backup.cron</span></span>
<span class="line"><span style="color:#A6ACCD;"># 每天3点钟执行备份</span></span>
<span class="line"><span style="color:#A6ACCD;">0 3 * * * bash /path/to/backmysql.sh</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">crontab</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql-backup.cron</span></span>
<span class="line"><span style="color:#FFCB6B;">crontab</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-l</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 0 3 * * * bash /path/to/backmysql.sh</span></span>
<span class="line"></span></code></pre></div>`,20),o=[p];function t(c,r,i,y,d,C){return a(),l("div",null,o)}const A=s(e,[["render",t]]);export{h as __pageData,A as default};
